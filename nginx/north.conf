# north nginx - external facing reverse proxy (path based)
upstream app1_up {
    server app1:80;
}
upstream app2_up {
    server app2:80;
}
upstream app3_up {
    server app3:80;
}

server {
    listen 80;
    server_name _;

    # simple path-based routing
    location /app1/ {
        proxy_pass http://app1_up/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /app2/ {
        proxy_pass http://app2_up/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /app3/ {
        proxy_pass http://app3_up/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /internal/ {
        # route to south nginx for internal API calls
        proxy_pass http://nginx_south/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
